import StateManager from"../StateManager.js";import AlgorithmsManager from"../algorithms/AlgorithmsManager.js";import Utils from"../utils/Utils.js";const VISITED_COLOR="rgba(0, 0, 66, 0.75)",CLOSED_COLOR="rgba(0, 190, 218, 0.75)";export default class GridAnimator{constructor(){this.stateManager=new StateManager,this.isAutoPlaying=!1,this.isPaused=!1,this.currentStep=0,this.steps=[],this.animationSpeed=30,this.lastFrameTime=0,this.animationFrameId=null,this.isActive=!1}async visualize(t){if(this.state=this.stateManager.getState(),this.nodes=this.stateManager.getNodes(),this.nodesElements=this.stateManager.getNodeElements(),this.state||!this.nodes.length||!this.nodesElements.length)return;this.stateManager.setState(!0),this.isActive=!0,this.isAutoPlaying=!0,this.isPaused=!1,this.currentStep=0,this.lastFrameTime=0,this.showControlButtons();const s=new AlgorithmsManager(this.stateManager.getNodes());switch(t){case"dijkstra":this.steps=s.dijkstra();break;case"astar":this.steps=s.aStar();break;case"dfs":this.steps=s.depthFS();break;case"bfs":this.steps=s.breadthFS()}this.updateControlButtons(),this.animate()}animate(t=0){if(this.isActive){if(this.isAutoPlaying&&!this.isPaused&&t-this.lastFrameTime>=this.animationSpeed){if(!(this.currentStep<this.steps.length))return void this.cleanup();this.executeStep(this.currentStep),this.currentStep++,this.updateControlButtons(),this.lastFrameTime=t}this.animationFrameId=requestAnimationFrame((t=>this.animate(t)))}else this.cleanup()}executeStep(t){if(t<0||t>=this.steps.length)return;const s=this.steps[t];console.count("step"),this.performStep(s)}performStep(t){const{type:s,indices:e}=t;"visited"===s?this.animateVisited(e[0]):"updated"===s?this.animateUpdated(e[0]):"finish"===s&&this.animateFinish(e)}animateVisited(t){let s=this.nodes[t],e=this.nodesElements[t];s.is_finish||s.is_start||(e.style.backgroundColor=VISITED_COLOR)}animateUpdated(t){let s=this.nodes[t],e=this.nodesElements[t];!s||s.is_finish||s.is_start||s.is_wall||(e.style.backgroundColor=CLOSED_COLOR)}animateFinish(t){let s=0,e=null;for(let i=0;i<t.length;i++){const n=t[i],a=this.nodesElements[n];a.classList.contains("node-start")&&(e=a),setTimeout((()=>{if(Utils.manipulateClasses(a,["node-path"]),a.classList.contains("node-finish")||Utils.manipulateClasses(a,["node-start"]),i>0){const s=this.nodesElements[t[i-1]];s.classList.contains("node-finish")||Utils.manipulateClasses(s,[],["node-start"])}i===t.length-1&&e&&setTimeout((()=>{Utils.manipulateClasses(a,[],["node-start"]),Utils.manipulateClasses(e,["node-start"])}),this.animationSpeed)}),s),s+=this.animationSpeed}}cleanup(){this.isActive=!1,this.isAutoPlaying=!1,this.isPaused=!1,this.animationFrameId&&(cancelAnimationFrame(this.animationFrameId),this.animationFrameId=null),this.hideControlButtons(),setTimeout((()=>{this.stateManager.setState(!1)}),0)}reset(){this.isActive=!1,this.isAutoPlaying=!1,this.isPaused=!1,this.currentStep=0,this.steps=[],this.animationFrameId&&(cancelAnimationFrame(this.animationFrameId),this.animationFrameId=null),this.hideControlButtons(),setTimeout((()=>{this.stateManager.setState(!1)}),0)}showControlButtons(){const t=document.querySelector(".button-group.control-actions"),s=document.querySelector(".navbar-buttons-pause");if(t&&(t.style.display="flex"),s){const t=s.querySelector("i");t&&(t.setAttribute("data-lucide","pause"),"undefined"!=typeof lucide&&lucide.createIcons()),s.title="Pause"}}hideControlButtons(){const t=document.querySelector(".button-group.control-actions");t&&(t.style.display="none")}updateControlButtons(){requestAnimationFrame((()=>{const t=document.querySelector(".navbar-buttons-pause"),s=document.querySelector(".navbar-buttons-step-back"),e=document.querySelector(".navbar-buttons-step-forward");if(t){const s=t.querySelector("i");this.isPaused||!this.isAutoPlaying?(t.title="Resume",s&&s.setAttribute("data-lucide","play")):this.isAutoPlaying&&(t.title="Pause",s&&s.setAttribute("data-lucide","pause")),"undefined"!=typeof lucide&&lucide.createIcons()}if(s){const t=this.canStepBack();s.disabled=!t,console.log("Step back button disabled:",!t)}if(e){const t=this.canStep();e.disabled=!t,console.log("Step forward button disabled:",!t)}}))}pause(){this.isActive&&(this.isPaused=!0,this.isAutoPlaying=!1,this.updateControlButtons())}resume(){this.isActive&&(this.isPaused=!1,this.isAutoPlaying=!0,this.updateControlButtons())}togglePauseResume(){console.log("togglePauseResume called",{isRunning:this.isRunning(),isActive:this.isActive,isPaused:this.isPaused,isAutoPlaying:this.isAutoPlaying}),this.isRunning()&&(this.isPaused?this.resume():this.pause())}stepForward(){console.log("stepForward called",{canStep:this.canStep(),isActive:this.isActive,currentStep:this.currentStep,stepsLength:this.steps.length}),this.canStep()&&(this.isAutoPlaying=!1,this.isPaused=!0,this.executeStep(this.currentStep),this.currentStep++,this.updateControlButtons())}stepBack(){console.log("stepBack called",{canStepBack:this.canStepBack(),isActive:this.isActive,currentStep:this.currentStep}),this.canStepBack()&&(this.isAutoPlaying=!1,this.isPaused=!0,this.currentStep--,this.undoStep(this.currentStep),this.updateControlButtons())}undoStep(t){if(t<0||t>=this.steps.length)return;const s=this.steps[t],{type:e,indices:i}=s;"visited"===e?this.undoVisited(i[0]):"updated"===e?this.undoUpdated(i[0]):"finish"===e&&this.undoFinish(i)}undoVisited(t){let s=this.nodes[t],e=this.nodesElements[t];s.is_finish||s.is_start||(e.style.backgroundColor="")}undoUpdated(t){let s=this.nodes[t],e=this.nodesElements[t];!s||s.is_finish||s.is_start||s.is_wall||(e.style.backgroundColor="")}undoFinish(t){for(let s=t.length-1;s>=0;s--){const e=t[s],i=this.nodesElements[e];Utils.manipulateClasses(i,[],["node-path","node-start"])}if(t.length>0){const s=t[0],e=this.nodesElements[s];Utils.manipulateClasses(e,["node-start"])}}setSpeed(t){this.animationSpeed={slow:100,normal:30,fast:5}[t]||30}setAnimationSpeed(t){this.setSpeed(t)}isRunning(){return this.isActive}canStep(){return this.isActive&&this.currentStep<this.steps.length}canStepBack(){return this.isActive&&this.currentStep>0}getProgress(){return this.steps.length?Math.min(this.currentStep/this.steps.length,1):0}}
//# sourceMappingURL=GridAnimator.js.map